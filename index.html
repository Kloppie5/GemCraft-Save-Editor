<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script type="text/javascript" src="pako.js"></script>
    <script>
      var state = "uninitialized"
      var savefile = ""

      function b64decode ( ) {
        savefile = atob(savefile)
        savefile = savefile.split('').map(function(x){return x.charCodeAt(0);});
        savefile = new Uint8Array(savefile);
        document.getElementById('savefile-b64decode').value = savefile
      }

      function zlib_decompress ( ) {
        savefile = pako.inflate(savefile);
        savefile = new Uint16Array(savefile)
        savefile = String.fromCharCode.apply(null, savefile);
        document.getElementById('savefile-zlib_decompress').value = savefile
      }

      function uncompress ( ) {
        var COMPRESSED_STRS = [" ","!","#","$","%","&","(",")","*",".",":",";","<",">","@","[","]","_","{","|","}"]
        var UNCOMPRESSED_STRS = [",B",",C",",D",",E",",F",",G",",H",",I",",J",",K",",L",",M",",N",",O",",P",",Q",",R",",S",",T",",U",",V"]
        for ( i = 0; i < 21; ++i )
          savefile = savefile.replaceAll(COMPRESSED_STRS[i],UNCOMPRESSED_STRS[i])
        document.getElementById('savefile-uncompress').value = savefile
      }

      function deserialize ( ) {
        savestring = savefile.split(',')
        savefile = {}

        savestring.shift() // VR
        savefile['gameVersion'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // RX
        savefile['recoveredEnduranceXp'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // RF
        savefile['recoveredEnduranceFieldStrId'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // RT
        savefile['recoveredEnduranceFragmentsBase64'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // AR
        savefile['achiResetSkillPtBonus'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // XP

        var STAGES = [
          "A1", "A2", "A3", "A4", "A5", "A6",
          "B1", "B2", "B3", "B4", "B5", "B6",
          "C1", "C2", "C3", "C4", "C5",
          "D1", "D2", "D3", "D4", "D5", "D6",
          "E1", "E2", "E3", "E4", "E5", "E6", "E7",
          "F1", "F2", "F3", "F4", "F5", "F6",
          "G1", "G2", "G3", "G4", "G5", "G6",
          "H1", "H2", "H3", "H4", "H5",
          "I1", "I2", "I3", "I4", "I5", "I6",
          "J1", "J2", "J3", "J4", "J5",
          "K1", "K2", "K3", "K4", "K5", "K6",
          "L1", "L2", "L3", "L4", "L5", "L6",
          "M1", "M2", "M3", "M4", "M5", "M6", "M7",
          "N1", "N2", "N3", "N4", "N5", "N6", "N7",
          "O1", "O2", "O3", "O4", "O5", "O6",
          "P1", "P2", "P3", "P4", "P5", "P6",
          "Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7",
          "R1", "R2", "R3", "R4", "R5", "R6",
          "T1", "T2", "T3", "T4", "T5", "T6", "T7", "T8",
          "U1", "U2", "U3", "U4", "U5", "U6",
          "W1", "W2", "W3", "W4", "W5", "W6",
          "X1", "X2", "X3", "X4", "X5", "X6", "X7",
          "Y1", "Y2", "Y3", "Y4", "Y5", "Y6",
          "V1", "V2", "V3", "V4",
          "H6", "U7",
          "V5", "V6", "V7", "V8", "V9", "V10", "V11", "V12", "V13", "V14", "V15", "V16", "V17", "V18", "V19", "V20", "V21", "V22", "V23",
          "A7", "B7", "C6", "C7", "D7", "E8", "F7", "G7", "H7", "I7", "J6", "K7", "L7", "M8", "O7", "P7", "P8", "Q8", "R7", "R8", "T9", "U8", "W7", "Y7"
        ]
        savefile['stageHighestXps'] = {}
        savefile['stageHighestDiffsCompleted'] = {}
        for ( i = 0; i < 191; ++i ) {
          savefile['stageHighestXps'][STAGES[i]] = savestring.shift()
          savefile['stageHighestDiffsCompleted'][STAGES[i]] = savestring.shift()
        }

        savestring.shift() // ?
        savestring.shift() // DU
        savefile['stageHighestEnduranceDiffsCompleted'] = {}
        for ( i = 0; i < 191; ++i ) {
          savefile['stageHighestEnduranceDiffsCompleted'][STAGES[i]] = savestring.shift()
        }

        savestring.shift() // ?
        savestring.shift() // TT
        savefile['stats'] = {}
        for ( i = 0; i < 60; ++i ) {
          savefile['stats'][i] = savestring.shift()
        }

        savestring.shift() // ?
        savestring.shift() // SK
        savefile['skillLevels'] = {}
        for ( i = 0; i < 26; ++i ) {
          savefile['skillLevels'][i] = savestring.shift()
        }

        savestring.shift() // ?
        savestring.shift() // AC
        savefile['achievements'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // TP
        savefile['gotTutorialPages'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // JP
        savefile['gotJourneyPages'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // HX
        savefile['gotMapHexTiles'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // ST
        savefile['gotSkillTomes'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // TS
        savefile['gotBattleTraitScrolls'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // DS
        savefile['gotBattleDifficultyScrolls'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // TI
        savefile['talismanInventory'] = {}
        for ( i = 0; i < 36; ++i ) {
          var vStr = savestring.shift()
          savefile['talismanInventory'][i] = vStr == "-1" ? "-1" : CryptoJS.enc.Base64.parse(vStr).toString(CryptoJS.enc.Utf8)
        }

        savestring.shift() // ?
        savestring.shift() // TA
        savefile['talismanSlots'] = {}
        for ( i = 0; i < 15; ++i ) {
          var vStr = savestring.shift()
          savefile['talismanSlots'][i] = vStr == "-1" ? "-1" : CryptoJS.enc.Base64.parse(vStr).toString(CryptoJS.enc.Utf8)
        }

        savestring.shift() // ?
        savestring.shift() // SB
        savefile['skillPtsBought'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // SC
        savefile['shadowCoreAmount'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // SW
        savefile['compassDirections'] = {}
        for ( i = 0; i < 7; ++i ) {
          savefile['compassDirections'][i] = savestring.shift()
        }
        savefile['compassSeed'] = savestring.shift()
        savefile['compassAwardsUnlocked'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // GM
        savefile['gameMode'] = savestring.shift()

        savestring.shift() // ?
        savestring.shift() // BL
        savefile['fragRarBoostLeft'] = savestring.shift()

        document.getElementById('savefile-deserialize').value = JSON.stringify(savefile, null, 2)
      }

      function decryptSave ( ) {
        var vChkString = savefile.substring(savefile.length - 16)
        var vStr = savefile.substring(0, savefile.length - 16)

        savefile = vStr

        b64decode()

        zlib_decompress()

        uncompress()

        deserialize()

        console.log(savefile)
      }

      async function loadSave ( event ) {
        const file = event.target.files.item(0)
        const contents = await file.text()
        state = "encrypted"
        savefile = contents
        document.getElementById('savefile-input').value = savefile
      }
    </script>
  </head>
  <body>
    \AppData\Roaming\GCCS\Local Store\<br>
    <input type="file" onchange="loadSave(event)"/><br/>
    <input type="button" value="Decrypt" onclick="decryptSave()"/><br/>
    Input:<br/>
    <textarea id="savefile-input" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    b64decode:<br/>
    <textarea id="savefile-b64decode" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    zlib_decompress:<br/>
    <textarea id="savefile-zlib_decompress" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    uncompress:<br/>
    <textarea id="savefile-uncompress" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    deserialize:<br/>
    <textarea id="savefile-deserialize" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
  </body>
</html>
