<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script type="text/javascript" src="pako.js"></script>
    <script>
      var state = "uninitialized"
      var savefile = ""

      function b64decode ( ) {
        savefile = atob(savefile)
        savefile = savefile.split('').map(function(x){return x.charCodeAt(0);});
        savefile = new Uint8Array(savefile);
        document.getElementById('savefile-b64decode').value = savefile
      }

      function zlib_decompress ( ) {
        savefile = pako.inflate(savefile);
        savefile = new Uint16Array(savefile)
        savefile = String.fromCharCode.apply(null, savefile);
        document.getElementById('savefile-zlib_decompress').value = savefile
      }

      function uncompress ( ) {
        var COMPRESSED_STRS = [" ","!","#","$","%","&","(",")","*",".",":",";","<",">","@","[","]","_","{","|","}"]
        var UNCOMPRESSED_STRS = [",B",",C",",D",",E",",F",",G",",H",",I",",J",",K",",L",",M",",N",",O",",P",",Q",",R",",S",",T",",U",",V"]
        for ( i = 0; i < 22; ++i )
          savefile = savefile.replaceAll(COMPRESSED_STRS[i],UNCOMPRESSED_STRS[i])
        document.getElementById('savefile-uncompress').value = savefile
      }

      function decryptSave ( ) {
        var vChkString = savefile.substring(savefile.length - 16)
        var vStr = savefile.substring(0, savefile.length - 16)

        console.log("vChkString: " + vChkString)
        console.log("vStr: " + vStr)

        savefile = vStr

        b64decode()

        zlib_decompress()

        uncompress()
      }

      async function loadSave ( event ) {
        const file = event.target.files.item(0)
        const contents = await file.text()
        state = "encrypted"
        savefile = contents
        document.getElementById('savefile-input').value = savefile
      }
    </script>
  </head>
  <body>
    \AppData\Roaming\GCCS\Local Store\<br>
    <input type="file" onchange="loadSave(event)"/><br/>
    <input type="button" value="Decrypt" onclick="decryptSave()"/><br/>
    Input:<br/>
    <textarea id="savefile-input" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    b64decode:<br/>
    <textarea id="savefile-b64decode" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    zlib_decompress:<br/>
    <textarea id="savefile-zlib_decompress" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
    uncompress:<br/>
    <textarea id="savefile-uncompress" style="width: 500px; height: 100px;" readonly="readonly"></textarea><br/>
  </body>
</html>
